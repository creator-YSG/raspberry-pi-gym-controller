# ğŸ—ï¸ ë¼ì¦ˆë² ë¦¬íŒŒì´ ë½ì¹´í‚¤ ëŒ€ì—¬ê¸° ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## ğŸ“‹ ì‹œìŠ¤í…œ ê°œìš”

ë¼ì¦ˆë² ë¦¬íŒŒì´ê°€ ì¤‘ì•™ ì œì–´ í—ˆë¸Œ ì—­í• ì„ í•˜ì—¬ 3ê°œì˜ ESP32ì™€ JSON í†µì‹ í•˜ë©°, í„°ì¹˜ìŠ¤í¬ë¦° GUIì™€ ì™¸ë¶€ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•˜ëŠ” í†µí•© ë½ì¹´í‚¤ ëŒ€ì—¬ ì‹œìŠ¤í…œ

## ğŸ”§ í•˜ë“œì›¨ì–´ êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ë½ì¹´í‚¤ ëŒ€ì—¬ê¸° ë°•ìŠ¤                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ë¼ì¦ˆë² ë¦¬íŒŒì´ 4B â”‚â”€â”€â”€â”€â”‚       í„°ì¹˜ìŠ¤í¬ë¦° ëª¨ë‹ˆí„°         â”‚  â”‚
â”‚  â”‚   (ì¤‘ì•™ì œì–´)    â”‚HDMIâ”‚        (ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚ WiFi (êµ¬ê¸€ì‹œíŠ¸ ì ‘ê·¼)                              â”‚
â”‚           â”‚                                                  â”‚
â”‚           â”‚ USB ì‹œë¦¬ì–¼ í†µì‹                                    â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚           â”‚                                                 â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚   ESP32 #1   â”‚  â”‚   ESP32 #2     â”‚  â”‚   ESP32 #3     â”‚  â”‚  â”‚
â”‚  â”‚ ë°”ì½”ë“œìŠ¤ìºë„ˆ â”‚  â”‚  ëª¨í„°ì œì–´#1    â”‚  â”‚  ëª¨í„°ì œì–´#2    â”‚  â”‚  â”‚
â”‚  â”‚    ë¦´ë ˆì´    â”‚  â”‚     ì„¼ì„œ       â”‚  â”‚     ì„¼ì„œ       â”‚  â”‚  â”‚
â”‚  â”‚  /dev/ttyUSB0â”‚  â”‚  /dev/ttyUSB1  â”‚  â”‚  /dev/ttyUSB2  â”‚  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›ï¸ ì†Œí”„íŠ¸ì›¨ì–´ ì•„í‚¤í…ì²˜

### ğŸ“¦ ëª¨ë“ˆ êµ¬ì¡°

```
raspberry-pi-gym-controller/
â”œâ”€â”€ core/                     # í•µì‹¬ ì‹œìŠ¤í…œ ëª¨ë“ˆ
â”‚   â””â”€â”€ esp32_manager.py     # ESP32 ì‹œë¦¬ì–¼ í†µì‹  ê´€ë¦¬ì
â”œâ”€â”€ hardware/                 # í•˜ë“œì›¨ì–´ ì œì–´ ëª¨ë“ˆ (ê¸°ì¡´ ESP32 í”„ë¡œí† ì½œ)
â”‚   â”œâ”€â”€ protocol_handler.py  # ESP32 ë©”ì‹œì§€ íŒŒì‹±
â”‚   â”œâ”€â”€ serial_scanner.py    # ì‹œë¦¬ì–¼ ë°”ì½”ë“œ ìŠ¤ìºë„ˆ
â”‚   â””â”€â”€ barcode_utils.py     # ë°”ì½”ë“œ ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ data_sources/             # ë°ì´í„° ì†ŒìŠ¤ ëª¨ë“ˆ
â”‚   â””â”€â”€ google_sheets.py     # êµ¬ê¸€ì‹œíŠ¸ API (WiFi)
â”œâ”€â”€ gui/                      # í„°ì¹˜ìŠ¤í¬ë¦° GUI
â”‚   â”œâ”€â”€ main_controller.py   # GUI ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬
â”‚   â”œâ”€â”€ screens/             # í™”ë©´ë³„ ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ widgets/             # ì¬ì‚¬ìš© ìœ„ì ¯
â”œâ”€â”€ services/                 # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ locker_service.py    # ë½ì¹´ ëŒ€ì—¬/ë°˜ë‚© ë¡œì§
â”‚   â””â”€â”€ member_service.py    # íšŒì› ê´€ë¦¬ ë¡œì§
â”œâ”€â”€ config/                   # ì„¤ì • íŒŒì¼
â”œâ”€â”€ scripts/                  # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ tests/                    # í…ŒìŠ¤íŠ¸
â””â”€â”€ main.py                   # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
```

## ğŸ”„ í†µì‹  í”„ë¡œí† ì½œ

### ESP32 â†” ë¼ì¦ˆë² ë¦¬íŒŒì´ USB ì‹œë¦¬ì–¼ í†µì‹ 

**ì‹œë¦¬ì–¼ í¬íŠ¸ êµ¬ì„±:**
- `/dev/ttyUSB0` : ESP32 #1 (ë°”ì½”ë“œ ìŠ¤ìºë„ˆ)
- `/dev/ttyUSB1` : ESP32 #2 (ëª¨í„° ì œì–´ #1) 
- `/dev/ttyUSB2` : ESP32 #3 (ëª¨í„° ì œì–´ #2)

**JSON ë©”ì‹œì§€ í˜•ì‹:**
```json
{
  "device_id": "esp32_barcode",
  "message_type": "command|response|event|status", 
  "timestamp": "2025-09-18T21:30:00Z",
  "data": {
    // ë©”ì‹œì§€ë³„ ë°ì´í„° êµ¬ì¡°
  }
}
```

**ì‹œë¦¬ì–¼ í†µì‹  ì„¤ì •:**
- Baudrate: 115200
- Data bits: 8
- Stop bits: 1
- Parity: None
- Flow control: None

#### 1. ë°”ì½”ë“œ ìŠ¤ìº” ì´ë²¤íŠ¸ (ESP32 â†’ ë¼ì¦ˆë² ë¦¬íŒŒì´)
```json
{
  "device_id": "esp32_barcode",
  "message_type": "event",
  "event_type": "barcode_scanned",
  "timestamp": "2025-09-18T21:30:00Z",
  "data": {
    "barcode": "1234567890123",
    "scan_type": "barcode|qr_code",
    "quality": 95
  }
}
```

#### 2. ëª¨í„° ì œì–´ ëª…ë ¹ (ë¼ì¦ˆë² ë¦¬íŒŒì´ â†’ ESP32)
```json
{
  "device_id": "esp32_motor_01",
  "message_type": "command",
  "command": "open_locker",
  "timestamp": "2025-09-18T21:30:00Z",
  "data": {
    "locker_id": "A001",
    "duration_ms": 3000,
    "confirm_required": true
  }
}
```

#### 3. ìƒíƒœ ì‘ë‹µ (ESP32 â†’ ë¼ì¦ˆë² ë¦¬íŒŒì´)
```json
{
  "device_id": "esp32_motor_01",
  "message_type": "response",
  "timestamp": "2025-09-18T21:30:00Z",
  "data": {
    "status": "success|error|busy",
    "locker_id": "A001",
    "action_completed": true,
    "error_message": null
  }
}
```

## ğŸ¯ ë°ì´í„° í”Œë¡œìš°

### 1. ë½ì¹´í‚¤ ëŒ€ì—¬ í”„ë¡œì„¸ìŠ¤
```
1. ì‚¬ìš©ì ë°”ì½”ë“œ ìŠ¤ìº” 
   â”œâ”€â–º ESP32(ë°”ì½”ë“œ) â†’ JSON â†’ ë¼ì¦ˆë² ë¦¬íŒŒì´
   â””â”€â–º ë¼ì¦ˆë² ë¦¬íŒŒì´: íšŒì› ìœ íš¨ì„± ê²€ì¦ (êµ¬ê¸€ì‹œíŠ¸/ë¡œì»¬DB)

2. ìœ íš¨ íšŒì› í™•ì¸ ì‹œ
   â”œâ”€â–º GUI: ë½ì¹´ ì„ íƒ í™”ë©´ í‘œì‹œ
   â”œâ”€â–º ì‚¬ìš©ì: í„°ì¹˜ìŠ¤í¬ë¦°ìœ¼ë¡œ ë½ì¹´ ì„ íƒ
   â””â”€â–º ë¼ì¦ˆë² ë¦¬íŒŒì´ â†’ JSON â†’ ESP32(ëª¨í„°): ë½ì¹´ ì—´ê¸°

3. ëŒ€ì—¬ ì™„ë£Œ
   â”œâ”€â–º ë°ì´í„° ê¸°ë¡ (êµ¬ê¸€ì‹œíŠ¸/ë¡œì»¬DB)
   â”œâ”€â–º GUI: ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
   â””â”€â–º ê°ì‚¬ ë¡œê·¸ ì €ì¥
```

### 2. ë½ì¹´í‚¤ ë°˜ë‚© í”„ë¡œì„¸ìŠ¤
```
1. ë½ì¹´í‚¤ ë°”ì½”ë“œ ìŠ¤ìº”
   â”œâ”€â–º ESP32(ë°”ì½”ë“œ) â†’ JSON â†’ ë¼ì¦ˆë² ë¦¬íŒŒì´
   â””â”€â–º ë¼ì¦ˆë² ë¦¬íŒŒì´: ëŒ€ì—¬ ê¸°ë¡ í™•ì¸

2. ìœ íš¨í•œ ë½ì¹´í‚¤ í™•ì¸ ì‹œ
   â”œâ”€â–º ë¼ì¦ˆë² ë¦¬íŒŒì´ â†’ JSON â†’ ESP32(ëª¨í„°): í•´ë‹¹ ë½ì¹´ ì—´ê¸°
   â””â”€â–º ëŒ€ì—¬ ê¸°ë¡ ì—…ë°ì´íŠ¸ (ë°˜ë‚© ì²˜ë¦¬)

3. ë°˜ë‚© ì™„ë£Œ
   â”œâ”€â–º GUI: ë°˜ë‚© ì™„ë£Œ ë©”ì‹œì§€
   â””â”€â–º ê°ì‚¬ ë¡œê·¸ ì €ì¥
```

## ğŸ”§ í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ì„¤ê³„

### 1. ESP32Manager (core/esp32_manager.py)
```python
class ESP32Manager:
    """ESP32 ë””ë°”ì´ìŠ¤ë“¤ê³¼ì˜ í†µì‹ ì„ ì´ê´„ ê´€ë¦¬"""
    
    def __init__(self):
        self.devices = {
            "barcode_scanner": ESP32Device("esp32_barcode", "192.168.0.101"),
            "motor_controller_1": ESP32Device("esp32_motor_01", "192.168.0.102"), 
            "motor_controller_2": ESP32Device("esp32_motor_02", "192.168.0.103")
        }
    
    async def send_command(self, device_id: str, command: dict) -> dict
    async def broadcast_status_request(self) -> dict
    def register_event_handler(self, event_type: str, handler: callable)
```

### 2. DataManager (core/data_manager.py)
```python
class DataManager:
    """êµ¬ê¸€ì‹œíŠ¸, ë¡œì»¬DB ë“± ëª¨ë“  ë°ì´í„° ì†ŒìŠ¤ ê´€ë¦¬"""
    
    async def validate_member(self, barcode: str) -> MemberInfo
    async def get_available_lockers(self) -> List[LockerInfo]
    async def record_rental(self, member_id: str, locker_id: str) -> bool
    async def process_return(self, locker_key_barcode: str) -> bool
```

### 3. GUIController (gui/main_controller.py) 
```python
class GUIController:
    """í„°ì¹˜ìŠ¤í¬ë¦° GUI ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬"""
    
    def __init__(self, esp32_manager: ESP32Manager, data_manager: DataManager):
        self.screens = {
            "home": HomeScreen(),
            "scan": ScanScreen(), 
            "locker_select": LockerSelectScreen(),
            "admin": AdminScreen()
        }
    
    def show_screen(self, screen_name: str, **kwargs)
    def handle_barcode_event(self, barcode_data: dict)
    def handle_locker_selection(self, locker_id: str)
```

## ğŸ›¡ï¸ ì˜¤ë¥˜ ì²˜ë¦¬ ë° ë³µêµ¬

### 1. ESP32 ì—°ê²° ì‹¤íŒ¨
- ìë™ ì¬ì—°ê²° ì‹œë„ (ìµœëŒ€ 3íšŒ)
- ëŒ€ì²´ ë””ë°”ì´ìŠ¤ë¡œ fallback
- ì‚¬ìš©ìì—ê²Œ ìƒíƒœ ì•Œë¦¼

### 2. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨  
- ë¡œì»¬ ìºì‹œëœ íšŒì› ë°ì´í„° ì‚¬ìš©
- ì—°ê²° ë³µêµ¬ ì‹œ ë™ê¸°í™”
- ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì „í™˜

### 3. ëª¨í„° ì œì–´ ì‹¤íŒ¨
- ìˆ˜ë™ ê°œì… ì•Œë¦¼
- ê´€ë¦¬ì í™”ë©´ì—ì„œ ìˆ˜ë™ ì œì–´
- ë¬¼ë¦¬ì  ë°±ì—… í‚¤ ì‚¬ìš© ì•ˆë‚´

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 1. ì‹¤ì‹œê°„ ìƒíƒœ ëª¨ë‹ˆí„°ë§
- ESP32 ë””ë°”ì´ìŠ¤ ìƒíƒœ
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ  
- ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
- ë½ì¹´ ì‚¬ìš© í˜„í™©

### 2. ê°ì‚¬ ë¡œê·¸
- ëª¨ë“  ëŒ€ì—¬/ë°˜ë‚© ê¸°ë¡
- ì‹œìŠ¤í…œ ì˜¤ë¥˜ ë¡œê·¸
- ì‚¬ìš©ì ì•¡ì…˜ ë¡œê·¸
- ê´€ë¦¬ì ì ‘ê·¼ ë¡œê·¸

## ğŸ”§ ì„¤ì • ê´€ë¦¬

### device_config.json
```json
{
  "esp32_devices": {
    "barcode_scanner": {
      "device_id": "esp32_barcode",
      "serial_port": "/dev/ttyUSB0",
      "baudrate": 115200,
      "type": "barcode_scanner"
    },
    "motor_controller_1": {
      "device_id": "esp32_motor_01", 
      "serial_port": "/dev/ttyUSB1",
      "baudrate": 115200,
      "type": "motor_controller",
      "managed_lockers": ["A001", "A002", "A003"]
    },
    "motor_controller_2": {
      "device_id": "esp32_motor_02", 
      "serial_port": "/dev/ttyUSB2",
      "baudrate": 115200,
      "type": "motor_controller",
      "managed_lockers": ["A004", "A005", "A006"]
    }
  },
  "data_sources": {
    "google_sheets": {
      "enabled": true,
      "sheet_id": "1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms",
      "credentials_file": "credentials.json"
    },
    "local_database": {
      "enabled": true,
      "db_path": "data/locker_system.db"
    }
  }
}
```

ì´ ì•„í‚¤í…ì²˜ëŠ” í™•ì¥ ê°€ëŠ¥í•˜ê³  ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•˜ë©°, ESP32ë“¤ê³¼ì˜ JSON í†µì‹ ì„ í†µí•´ ì•ˆì •ì ì¸ ë½ì¹´í‚¤ ëŒ€ì—¬ ì‹œìŠ¤í…œì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
