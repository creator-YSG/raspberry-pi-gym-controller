{# 
  비밀번호 입력 모달 컴포넌트
  숫자 키패드 포함
  
  사용법: {% include 'components/password_modal.html' %}
#}

<!-- 비밀번호 입력 모달 -->
<div class="password-modal" id="passwordModal" style="display: none;">
    <div class="password-modal-content">
        <div class="password-modal-title">관리자 비밀번호 입력</div>
        <input type="password" id="adminPasswordInput" class="password-input" placeholder="••••" maxlength="20" readonly />
        
        <!-- 숫자 키패드 -->
        <div class="numpad">
            <div class="numpad-row">
                <button class="numpad-key" onclick="numpadPress('1')">1</button>
                <button class="numpad-key" onclick="numpadPress('2')">2</button>
                <button class="numpad-key" onclick="numpadPress('3')">3</button>
            </div>
            <div class="numpad-row">
                <button class="numpad-key" onclick="numpadPress('4')">4</button>
                <button class="numpad-key" onclick="numpadPress('5')">5</button>
                <button class="numpad-key" onclick="numpadPress('6')">6</button>
            </div>
            <div class="numpad-row">
                <button class="numpad-key" onclick="numpadPress('7')">7</button>
                <button class="numpad-key" onclick="numpadPress('8')">8</button>
                <button class="numpad-key" onclick="numpadPress('9')">9</button>
            </div>
            <div class="numpad-row">
                <button class="numpad-key numpad-clear" onclick="numpadClear()">C</button>
                <button class="numpad-key" onclick="numpadPress('0')">0</button>
                <button class="numpad-key numpad-back" onclick="numpadBack()">⌫</button>
            </div>
        </div>
        
        <div class="password-modal-buttons">
            <button class="btn-cancel" onclick="closePasswordModal()">취소</button>
            <button class="btn-confirm" onclick="verifyPassword()">확인</button>
        </div>
        <div class="password-error" id="passwordError" style="display: none;">비밀번호가 틀렸습니다.</div>
    </div>
</div>

<style>
/* 비밀번호 모달 */
.password-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.password-modal-content {
    background: linear-gradient(145deg, #2a2a3e, #1e1e2e);
    border-radius: 24px;
    padding: 30px 40px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.1);
    min-width: 320px;
}

.password-modal-title {
    font-size: 1.4rem;
    font-weight: 600;
    color: #fff;
    margin-bottom: 20px;
}

.password-input {
    width: 100%;
    padding: 15px 20px;
    font-size: 2rem;
    text-align: center;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    outline: none;
    transition: border-color 0.3s;
    box-sizing: border-box;
    letter-spacing: 0.5em;
}

.password-input:focus {
    border-color: #4caf50;
}

.password-input::placeholder {
    color: rgba(255, 255, 255, 0.3);
    letter-spacing: 0.3em;
}

/* 숫자 키패드 */
.numpad {
    margin: 20px 0;
}

.numpad-row {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 10px;
}

.numpad-key {
    width: 70px;
    height: 60px;
    font-size: 1.8rem;
    font-weight: 600;
    border: none;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.15);
    color: #fff;
    cursor: pointer;
    transition: all 0.15s ease;
}

.numpad-key:hover {
    background: rgba(255, 255, 255, 0.25);
}

.numpad-key:active {
    transform: scale(0.95);
    background: rgba(255, 255, 255, 0.35);
}

.numpad-clear {
    background: rgba(244, 67, 54, 0.4);
}

.numpad-clear:hover {
    background: rgba(244, 67, 54, 0.6);
}

.numpad-back {
    background: rgba(255, 152, 0, 0.4);
}

.numpad-back:hover {
    background: rgba(255, 152, 0, 0.6);
}

.password-modal-buttons {
    display: flex;
    gap: 15px;
    margin-top: 20px;
}

.password-modal-buttons button {
    flex: 1;
    padding: 14px 25px;
    font-size: 1.1rem;
    font-weight: 600;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-cancel {
    background: rgba(255, 255, 255, 0.15);
    color: #fff;
}

.btn-cancel:hover {
    background: rgba(255, 255, 255, 0.25);
}

.btn-confirm {
    background: linear-gradient(135deg, #4caf50, #45a049);
    color: #fff;
}

.btn-confirm:hover {
    background: linear-gradient(135deg, #5cbf60, #4caf50);
    transform: translateY(-2px);
}

.password-error {
    color: #ff6b6b;
    margin-top: 15px;
    font-size: 0.95rem;
    animation: shake 0.3s ease;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-8px); }
    75% { transform: translateX(8px); }
}
</style>

<script>
// 숫자 키패드 함수
function numpadPress(num) {
    const input = document.getElementById('adminPasswordInput');
    if (input.value.length < 20) {
        input.value += num;
    }
}

function numpadClear() {
    document.getElementById('adminPasswordInput').value = '';
}

function numpadBack() {
    const input = document.getElementById('adminPasswordInput');
    input.value = input.value.slice(0, -1);
}

function showPasswordModal() {
    const modal = document.getElementById('passwordModal');
    const input = document.getElementById('adminPasswordInput');
    const error = document.getElementById('passwordError');
    
    modal.style.display = 'flex';
    error.style.display = 'none';
    input.value = '';
}

function closePasswordModal() {
    const modal = document.getElementById('passwordModal');
    modal.style.display = 'none';
    document.getElementById('adminPasswordInput').value = '';
    
    // 바코드 입력 필드가 있으면 포커스 복귀
    const barcodeInput = document.getElementById('barcodeInput');
    if (barcodeInput) barcodeInput.focus();
}

function verifyPassword() {
    const input = document.getElementById('adminPasswordInput');
    const error = document.getElementById('passwordError');
    const password = input.value;
    
    fetch('/api/verify-admin-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: password })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log('✅ 비밀번호 인증 성공');
            window.location.href = data.redirect || '/settings';
        } else {
            console.log('❌ 비밀번호 인증 실패');
            error.style.display = 'block';
            input.value = '';
        }
    })
    .catch(err => {
        console.error('❌ 비밀번호 검증 오류:', err);
        error.textContent = '시스템 오류가 발생했습니다.';
        error.style.display = 'block';
    });
}
</script>

