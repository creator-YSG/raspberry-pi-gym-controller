{% extends "layouts/base.html" %}

{% block title %}ì„¼ì„œ ë§¤í•‘ ì„¤ì •{% endblock %}

{% block body_class %}settings-page{% endblock %}

{% block content %}
<div class="settings-container">
    <!-- ì¢Œì¸¡ ìƒë‹¨: ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
    <div class="back-button-container">
        <button class="back-button" onclick="window.location.href='/settings'">
            â† ì„¤ì •ìœ¼ë¡œ
        </button>
    </div>

    <!-- í˜ì´ì§€ ì œëª© -->
    <div class="settings-header">
        <h1>ğŸ”§ ì„¼ì„œ ë§¤í•‘ ì„¤ì •</h1>
        <p class="settings-subtitle">60ê°œ ë½ì»¤ì— ì„¼ì„œë¥¼ ë§¤í•‘í•˜ì„¸ìš”</p>
    </div>

    <!-- ë¬¸ ì œì–´ ë²„íŠ¼ë“¤ -->
    <div class="door-control-buttons">
        <button class="door-btn door-btn-open" id="openAllDoorsBtn">
            ğŸšª ì „ì²´ ë¬¸ ì—´ê¸°
        </button>
        <button class="door-btn door-btn-close" id="closeAllDoorsBtn">
            ğŸ”’ ì „ì²´ ë¬¸ ë‹«ê¸°
        </button>
    </div>

    <!-- ì„¼ì„œ ê°ì§€ ìƒíƒœ í‘œì‹œ -->
    <div class="sensor-status" id="sensorStatus">
        <div class="sensor-indicator">
            <div class="sensor-light" id="sensorLight"></div>
            <span id="sensorStatusText">ì„¼ì„œë¥¼ ê°ì§€í•˜ì„¸ìš”</span>
        </div>
        <div class="sensor-info-display">
            <div class="sensor-info-item">
                <label>Address:</label>
                <span id="currentAddr">---</span>
            </div>
            <div class="sensor-info-item">
                <label>Chip:</label>
                <span id="currentChip">---</span>
            </div>
            <div class="sensor-info-item">
                <label>Pin:</label>
                <span id="currentPin">---</span>
            </div>
        </div>
    </div>

    <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
    <div class="action-buttons">
        <button class="action-btn action-btn-save" id="saveBtn" disabled>
            ğŸ’¾ ì €ì¥
        </button>
        <button class="action-btn action-btn-unregister" id="unregisterBtn" disabled>
            ğŸ—‘ï¸ í•´ì œ
        </button>
    </div>

    <!-- ë½ì»¤ ê·¸ë¦¬ë“œ -->
    <div class="locker-grid-container">
        <!-- STAFF êµ¬ì—­ -->
        <div class="zone-section">
            <h2 class="zone-title">êµì§ì› êµ¬ì—­ (S01-S10)</h2>
            <div class="locker-grid" id="staffGrid">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
        </div>

        <!-- MALE êµ¬ì—­ -->
        <div class="zone-section">
            <h2 class="zone-title">ë‚¨ì„± êµ¬ì—­ (M01-M40)</h2>
            <div class="locker-grid" id="maleGrid">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
        </div>

        <!-- FEMALE êµ¬ì—­ -->
        <div class="zone-section">
            <h2 class="zone-title">ì—¬ì„± êµ¬ì—­ (F01-F10)</h2>
            <div class="locker-grid" id="femaleGrid">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
        </div>
    </div>
</div>

<style>
.settings-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */
.back-button-container {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
}

.back-button {
    background: rgba(255, 255, 255, 0.15);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 12px;
    padding: 12px 20px;
    cursor: pointer;
    font-size: 18px;
    color: white;
    transition: all 0.3s ease;
}

.back-button:hover {
    background: rgba(255, 255, 255, 0.25);
    border-color: rgba(255, 255, 255, 0.5);
    transform: translateY(-2px);
}

/* í—¤ë” */
.settings-header {
    text-align: center;
    margin-bottom: 30px;
}

.settings-header h1 {
    color: white;
    font-size: 2.5rem;
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

.settings-subtitle {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.2rem;
}

/* ë¬¸ ì œì–´ ë²„íŠ¼ë“¤ */
.door-control-buttons {
    display: flex;
    gap: 15px;
    margin-bottom: 30px;
}

.door-btn {
    padding: 15px 30px;
    border: none;
    border-radius: 12px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.door-btn-open {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
}

.door-btn-open:hover {
    background: linear-gradient(135deg, #45a049, #4CAF50);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
}

.door-btn-close {
    background: linear-gradient(135deg, #f44336, #d32f2f);
    color: white;
}

.door-btn-close:hover {
    background: linear-gradient(135deg, #d32f2f, #f44336);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(244, 67, 54, 0.4);
}

/* ì„¼ì„œ ìƒíƒœ í‘œì‹œ */
.sensor-status {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    min-width: 600px;
    backdrop-filter: blur(10px);
}

.sensor-indicator {
    display: flex;
    align-items: center;
    gap: 15px;
}

.sensor-light {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #666;
    transition: all 0.3s ease;
}

.sensor-light.active {
    background: #4CAF50;
    box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
}

#sensorStatusText {
    color: white;
    font-size: 18px;
    font-weight: bold;
}

.sensor-info-display {
    display: flex;
    gap: 20px;
}

.sensor-info-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
}

.sensor-info-item label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 14px;
    font-weight: bold;
}

.sensor-info-item span {
    color: white;
    font-size: 16px;
    font-family: monospace;
    background: rgba(255, 255, 255, 0.1);
    padding: 5px 10px;
    border-radius: 6px;
    min-width: 60px;
    text-align: center;
}

/* ì•¡ì…˜ ë²„íŠ¼ë“¤ */
.action-buttons {
    display: flex;
    gap: 15px;
    margin-bottom: 30px;
}

.action-btn {
    padding: 15px 30px;
    border: none;
    border-radius: 12px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.action-btn-save {
    background: linear-gradient(135deg, #2196F3, #1976D2);
    color: white;
}

.action-btn-save:hover:not(:disabled) {
    background: linear-gradient(135deg, #1976D2, #2196F3);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
}

.action-btn-unregister {
    background: linear-gradient(135deg, #FF9800, #F57C00);
    color: white;
}

.action-btn-unregister:hover:not(:disabled) {
    background: linear-gradient(135deg, #F57C00, #FF9800);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
}

.action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2) !important;
}

/* ë½ì»¤ ê·¸ë¦¬ë“œ */
.locker-grid-container {
    width: 100%;
    max-width: 1200px;
}

.zone-section {
    margin-bottom: 40px;
}

.zone-title {
    color: white;
    font-size: 1.5rem;
    margin-bottom: 15px;
    text-align: center;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

.locker-grid {
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    gap: 8px;
    margin-bottom: 20px;
}

.locker-card {
    aspect-ratio: 1;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    border: 2px solid rgba(255, 255, 255, 0.3);
    background: rgba(255, 255, 255, 0.1);
    color: white;
    backdrop-filter: blur(5px);
}

.locker-card:hover {
    transform: scale(1.05);
    border-color: rgba(255, 255, 255, 0.6);
    background: rgba(255, 255, 255, 0.15);
}

.locker-card.selected {
    background: linear-gradient(135deg, #2196F3, #1976D2);
    border-color: #2196F3;
    color: white;
    box-shadow: 0 0 20px rgba(33, 150, 243, 0.5);
}

.locker-card.mapped {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    border-color: #4CAF50;
    box-shadow: 0 0 15px rgba(76, 175, 80, 0.3);
}

.locker-card.mapped.selected {
    background: linear-gradient(135deg, #FF9800, #F57C00);
    border-color: #FF9800;
    box-shadow: 0 0 20px rgba(255, 152, 0, 0.5);
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
    .settings-container {
        padding: 10px;
    }

    .settings-header h1 {
        font-size: 2rem;
    }

    .locker-grid {
        grid-template-columns: repeat(5, 1fr);
        gap: 5px;
    }

    .sensor-status {
        flex-direction: column;
        gap: 15px;
        min-width: auto;
    }

    .sensor-info-display {
        justify-content: center;
    }

    .door-control-buttons,
    .action-buttons {
        flex-direction: column;
        gap: 10px;
    }

    .door-btn,
    .action-btn {
        padding: 12px 24px;
        font-size: 16px;
    }
}
</style>

<script>
// ì „ì—­ ë³€ìˆ˜
let currentLockerId = null;
let currentSensorData = null;
let sensorMappings = {};

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    initializePage();
});

function initializePage() {
    // ë½ì»¤ ê·¸ë¦¬ë“œ ìƒì„±
    createLockerGrids();

    // ê¸°ì¡´ ë§¤í•‘ ë°ì´í„° ë¡œë“œ
    loadSensorMappings();

    // ì„¼ì„œ í´ë§ ì‹œì‘
    startSensorPolling();

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    setupEventListeners();

    console.log('[SensorMapping] í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
}

function createLockerGrids() {
    // STAFF êµ¬ì—­ (S01-S10)
    const staffGrid = document.getElementById('staffGrid');
    for (let i = 1; i <= 10; i++) {
        const lockerId = `S${i.toString().padStart(2, '0')}`;
        const card = createLockerCard(lockerId);
        staffGrid.appendChild(card);
    }

    // MALE êµ¬ì—­ (M01-M40)
    const maleGrid = document.getElementById('maleGrid');
    for (let i = 1; i <= 40; i++) {
        const lockerId = `M${i.toString().padStart(2, '0')}`;
        const card = createLockerCard(lockerId);
        maleGrid.appendChild(card);
    }

    // FEMALE êµ¬ì—­ (F01-F10)
    const femaleGrid = document.getElementById('femaleGrid');
    for (let i = 1; i <= 10; i++) {
        const lockerId = `F${i.toString().padStart(2, '0')}`;
        const card = createLockerCard(lockerId);
        femaleGrid.appendChild(card);
    }
}

function createLockerCard(lockerId) {
    const card = document.createElement('div');
    card.className = 'locker-card';
    card.textContent = lockerId;
    card.dataset.lockerId = lockerId;

    card.addEventListener('click', () => selectLocker(lockerId));

    return card;
}

function selectLocker(lockerId) {
    // ê¸°ì¡´ ì„ íƒ í•´ì œ
    document.querySelectorAll('.locker-card.selected').forEach(card => {
        card.classList.remove('selected');
    });

    // ìƒˆë¡œìš´ ì„ íƒ
    const card = document.querySelector(`[data-locker-id="${lockerId}"]`);
    if (card) {
        card.classList.add('selected');
        currentLockerId = lockerId;
        updateButtonStates();
        console.log(`[SensorMapping] ë½ì»¤ ì„ íƒ: ${lockerId}`);
    }
}

function loadSensorMappings() {
    fetch('/api/sensor/mappings')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                sensorMappings = {};

                // ë§¤í•‘ ë°ì´í„°ë¥¼ locker_id ê¸°ì¤€ìœ¼ë¡œ ì •ë¦¬
                ['male_zone', 'female_zone', 'staff_zone'].forEach(zone => {
                    data.mappings[zone].forEach(mapping => {
                        sensorMappings[mapping.locker_id] = mapping;
                    });
                });

                // UI ì—…ë°ì´íŠ¸
                updateLockerCards();
                console.log('[SensorMapping] ë§¤í•‘ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', sensorMappings);
            } else {
                console.error('[SensorMapping] ë§¤í•‘ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', data.error);
            }
        })
        .catch(error => {
            console.error('[SensorMapping] ë§¤í•‘ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
        });
}

function updateLockerCards() {
    document.querySelectorAll('.locker-card').forEach(card => {
        const lockerId = card.dataset.lockerId;
        const mapping = sensorMappings[lockerId];

        if (mapping) {
            card.classList.add('mapped');
            card.title = `Addr: ${mapping.addr}, Chip: ${mapping.chip_idx}, Pin: ${mapping.pin}`;
        } else {
            card.classList.remove('mapped');
            card.title = '';
        }
    });
}

function startSensorPolling() {
    setInterval(pollSensorData, 500); // 0.5ì´ˆë§ˆë‹¤ í´ë§
}

function pollSensorData() {
    fetch('/api/sensor/poll')
        .then(response => response.json())
        .then(data => {
            // /api/sensor/pollì€ {has_events, events} í˜•íƒœë¡œ ë°˜í™˜
            if (data.has_events && data.events && data.events.length > 0) {
                const latestEvent = data.events[data.events.length - 1];
                onSensorDetected(latestEvent);
            }
        })
        .catch(error => {
            console.debug('[SensorMapping] ì„¼ì„œ í´ë§ ì˜¤ë¥˜ (ë¬´ì‹œ):', error);
        });
}

function onSensorDetected(sensorEvent) {
    // ì„¼ì„œ ì´ë²¤íŠ¸ì—ì„œ í•˜ë“œì›¨ì–´ ì •ë³´ ì¶”ì¶œ
    const addr = sensorEvent.addr || sensorEvent.address;
    const chipIdx = sensorEvent.chip_idx;
    const pin = sensorEvent.pin;

    if (addr && chipIdx !== undefined && pin !== undefined) {
        currentSensorData = { addr, chip_idx: chipIdx, pin };

        // UI ì—…ë°ì´íŠ¸
        document.getElementById('currentAddr').textContent = addr;
        document.getElementById('currentChip').textContent = chipIdx;
        document.getElementById('currentPin').textContent = pin;
        document.getElementById('sensorLight').className = 'sensor-light active';
        document.getElementById('sensorStatusText').textContent = 'ì„¼ì„œ ê°ì§€ë¨';

        updateButtonStates();
        console.log('[SensorMapping] ì„¼ì„œ ê°ì§€:', currentSensorData);
    }
}

function updateButtonStates() {
    const saveBtn = document.getElementById('saveBtn');
    const unregisterBtn = document.getElementById('unregisterBtn');

    // ì €ì¥ ë²„íŠ¼: ë½ì»¤ ì„ íƒ + ì„¼ì„œ ê°ì§€ ì‹œ í™œì„±í™”
    if (currentLockerId && currentSensorData) {
        saveBtn.disabled = false;
    } else {
        saveBtn.disabled = true;
    }

    // í•´ì œ ë²„íŠ¼: ë½ì»¤ ì„ íƒ + ë§¤í•‘ ì¡´ì¬ ì‹œ í™œì„±í™”
    if (currentLockerId && sensorMappings[currentLockerId]) {
        unregisterBtn.disabled = false;
    } else {
        unregisterBtn.disabled = true;
    }
}

function setupEventListeners() {
    // ë¬¸ ì œì–´ ë²„íŠ¼ë“¤
    document.getElementById('openAllDoorsBtn').addEventListener('click', openAllDoors);
    document.getElementById('closeAllDoorsBtn').addEventListener('click', closeAllDoors);

    // ì•¡ì…˜ ë²„íŠ¼ë“¤
    document.getElementById('saveBtn').addEventListener('click', saveMapping);
    document.getElementById('unregisterBtn').addEventListener('click', unregisterMapping);
}

function openAllDoors() {
    if (!confirm('ì •ë§ë¡œ ì „ì²´ ë¬¸ì„ ì—´ê² ìŠµë‹ˆê¹Œ?')) return;

    document.getElementById('openAllDoorsBtn').disabled = true;
    document.getElementById('openAllDoorsBtn').textContent = 'ì—´ê¸° ì¤‘...';

    fetch('/api/esp32/door/open-all', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('ì „ì²´ ë¬¸ ì—´ê¸° ëª…ë ¹ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                alert('ì „ì²´ ë¬¸ ì—´ê¸° ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        })
        .catch(error => {
            alert('ì „ì²´ ë¬¸ ì—´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            console.error('[SensorMapping] ì „ì²´ ë¬¸ ì—´ê¸° ì˜¤ë¥˜:', error);
        })
        .finally(() => {
            document.getElementById('openAllDoorsBtn').disabled = false;
            document.getElementById('openAllDoorsBtn').textContent = 'ğŸšª ì „ì²´ ë¬¸ ì—´ê¸°';
        });
}

function closeAllDoors() {
    if (!confirm('ì •ë§ë¡œ ì „ì²´ ë¬¸ì„ ë‹«ê² ìŠµë‹ˆê¹Œ?')) return;

    document.getElementById('closeAllDoorsBtn').disabled = true;
    document.getElementById('closeAllDoorsBtn').textContent = 'ë‹«ê¸° ì¤‘...';

    fetch('/api/esp32/door/close-all', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('ì „ì²´ ë¬¸ ë‹«ê¸° ëª…ë ¹ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                alert('ì „ì²´ ë¬¸ ë‹«ê¸° ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        })
        .catch(error => {
            alert('ì „ì²´ ë¬¸ ë‹«ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            console.error('[SensorMapping] ì „ì²´ ë¬¸ ë‹«ê¸° ì˜¤ë¥˜:', error);
        })
        .finally(() => {
            document.getElementById('closeAllDoorsBtn').disabled = false;
            document.getElementById('closeAllDoorsBtn').textContent = 'ğŸ”’ ì „ì²´ ë¬¸ ë‹«ê¸°';
        });
}

function saveMapping() {
    if (!currentLockerId || !currentSensorData) {
        alert('ë½ì»¤ì™€ ì„¼ì„œë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }

    const requestData = {
        addr: currentSensorData.addr,
        chip_idx: currentSensorData.chip_idx,
        pin: currentSensorData.pin,
        locker_id: currentLockerId
    };

    console.log('[SensorMapping] ë§¤í•‘ ì €ì¥ ìš”ì²­:', requestData);

    fetch('/api/sensor/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(`ì„¼ì„œ ë§¤í•‘ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: ${currentLockerId}`);
            loadSensorMappings(); // ë§¤í•‘ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            resetSensorState();
        } else {
            alert('ì„¼ì„œ ë§¤í•‘ ì €ì¥ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
        }
    })
    .catch(error => {
        alert('ì„¼ì„œ ë§¤í•‘ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        console.error('[SensorMapping] ë§¤í•‘ ì €ì¥ ì˜¤ë¥˜:', error);
    });
}

function unregisterMapping() {
    if (!currentLockerId) {
        alert('ë½ì»¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }

    if (!confirm(`ì •ë§ë¡œ ${currentLockerId}ì˜ ì„¼ì„œ ë§¤í•‘ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

    console.log('[SensorMapping] ë§¤í•‘ í•´ì œ ìš”ì²­:', currentLockerId);

    fetch(`/api/sensor/unregister/${currentLockerId}`, { method: 'DELETE' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(`ì„¼ì„œ ë§¤í•‘ì´ ì„±ê³µì ìœ¼ë¡œ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤: ${currentLockerId}`);
                loadSensorMappings(); // ë§¤í•‘ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                resetSensorState();
            } else {
                alert('ì„¼ì„œ ë§¤í•‘ í•´ì œ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        })
        .catch(error => {
            alert('ì„¼ì„œ ë§¤í•‘ í•´ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            console.error('[SensorMapping] ë§¤í•‘ í•´ì œ ì˜¤ë¥˜:', error);
        });
}

function resetSensorState() {
    // ì„¼ì„œ ìƒíƒœ ì´ˆê¸°í™”
    currentSensorData = null;
    document.getElementById('currentAddr').textContent = '---';
    document.getElementById('currentChip').textContent = '---';
    document.getElementById('currentPin').textContent = '---';
    document.getElementById('sensorLight').className = 'sensor-light';
    document.getElementById('sensorStatusText').textContent = 'ì„¼ì„œë¥¼ ê°ì§€í•˜ì„¸ìš”';

    updateButtonStates();
}
</script>
{% endblock %}