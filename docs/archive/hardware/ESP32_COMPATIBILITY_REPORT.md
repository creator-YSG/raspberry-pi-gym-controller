# ESP32 μ½”λ“ νΈν™μ„± λ¶„μ„ λ³΄κ³ μ„

## π“‹ κ°μ”

ESP32 ν—¬μ¤μ¥ μ»¨νΈλ΅¤λ¬ v7.1 μ½”λ“μ™€ λΌμ¦λ² λ¦¬νμ΄ μ‹μ¤ν… κ°„μ νΈν™μ„±μ„ λ¶„μ„ν• κ²°κ³Όμ…λ‹λ‹¤.

**λ¶„μ„ μΌμ‹**: 2025λ…„ 10μ›” 13μΌ  
**ESP32 μ½”λ“ λ²„μ „**: v7.1 (1/2 λ§μ΄ν¬λ΅μ¤ν… + OTA κ°•ν™”)  
**λΌμ¦λ² λ¦¬νμ΄ μ‹μ¤ν…**: μ™„μ „ ν†µν•© ν—¬μ¤μ¥ λ½μ»¤ μ‹μ¤ν…

---

## β… μ™„λ²½ νΈν™ κΈ°λ¥

### 1. ν†µμ‹  ν”„λ΅ν† μ½
- **JSON λ©”μ‹μ§€ ν•μ‹**: ESP32μ™€ λΌμ¦λ² λ¦¬νμ΄ λ¨λ‘ λ™μΌν• JSON κµ¬μ΅° μ‚¬μ©
- **μ‹λ¦¬μ–Ό ν†µμ‹ **: 115200 baud rateλ΅ μ™„λ²½ νΈν™
- **λ©”μ‹μ§€ νμ‹±**: λ¨λ“  ESP32 λ©”μ‹μ§€ νƒ€μ…μ΄ λΌμ¦λ² λ¦¬νμ΄μ—μ„ μ •μƒ νμ‹±

### 2. λ°”μ½”λ“ μ¤μΊ” μ‹μ¤ν…
```json
// ESP32 β†’ λΌμ¦λ² λ¦¬νμ΄
{
  "device_id": "esp32_gym",
  "message_type": "event",
  "event_type": "barcode_scanned",
  "data": {
    "barcode": "1234567890",
    "scan_count": 1
  }
}
```
- **β… μ™„λ²½ νΈν™**: λΌμ¦λ² λ¦¬νμ΄ ν”„λ΅ν† μ½ ν•Έλ“¤λ¬μ—μ„ μ •μƒ μ²λ¦¬
- **β… μλ™ κ°μ§€**: λ°”μ½”λ“ νƒ€μ… μλ™ νλ³„ (νμ›/λ½μ»¤ν‚¤)
- **β… ν†µκ³„ μ§€μ›**: μ¤μΊ” νμ μ¶”μ 

### 3. λ½μ»¤ μ μ–΄ μ‹μ¤ν…
```json
// λΌμ¦λ² λ¦¬νμ΄ β†’ ESP32 (λ½μ»¤ μ—΄κΈ° λ…λ Ή)
{
  "command": "open_locker",
  "locker_id": "M01",
  "duration_ms": 3000
}

// ESP32 β†’ λΌμ¦λ² λ¦¬νμ΄ (μ™„λ£ μ‘λ‹µ)
{
  "device_id": "esp32_gym",
  "message_type": "response",
  "event_type": "locker_opened",
  "data": {
    "locker_id": "M01",
    "status": "opened",
    "steps": 367
  }
}
```
- **β… μ •ν™•ν• νμ „**: 330λ„ (0.917νμ „) = 367μ¤ν… (1/2 λ§μ΄ν¬λ΅μ¤ν…)
- **β… μ‘λ‹µ μ²λ¦¬**: λ½μ»¤ μ—΄κΈ° μ™„λ£ μ΄λ²¤νΈ μ •μƒ νμ‹±
- **β… μ—λ¬ μ²λ¦¬**: MOTOR_BUSY λ“± μƒμ„Έν• μ—λ¬ μ‘λ‹µ

### 4. μ„Όμ„ μ‹μ¤ν…
```json
// ESP32 β†’ λΌμ¦λ² λ¦¬νμ΄ (IR μ„Όμ„ κ°μ§€)
{
  "device_id": "esp32_gym",
  "message_type": "event",
  "event_type": "sensor_triggered",
  "data": {
    "chip_idx": 0,
    "addr": "0x20",
    "pin": 5,
    "state": "LOW",
    "active": true
  }
}
```
- **β… MCP23017 μ§€μ›**: μµλ€ 8κ° μΉ©, 128κ° μ„Όμ„
- **β… λ””λ°”μ΄μ‹±**: 15ms λ””λ°”μ΄μ‹±μΌλ΅ μ¤μ‘λ™ λ°©μ§€
- **β… μ‹¤μ‹κ°„ κ°μ§€**: μ„Όμ„ μƒνƒ λ³€ν™” μ¦‰μ‹ μ „μ†΅

### 5. μƒνƒ λ¨λ‹ν„°λ§
```json
// ESP32 μƒνƒ μ‘λ‹µ
{
  "device_id": "esp32_gym",
  "message_type": "response",
  "data": {
    "status": "ready",
    "uptime": 60000,
    "wifi": true,
    "motor_busy": false,
    "mcp_count": 2,
    "total_scans": 10,
    "total_ir_events": 25,
    "total_motor_moves": 5,
    "microstep": 2,
    "steps_per_rev": 400,
    "ip": "192.168.1.100",
    "rssi": -45,
    "hostname": "ESP32-GYM-LOCKER"
  }
}
```
- **β… μ‹¤μ‹κ°„ μƒνƒ**: WiFi, λ¨ν„°, μ„Όμ„ μƒνƒ λ¨λ‹ν„°λ§
- **β… ν†µκ³„ μ •λ³΄**: μ¤μΊ”/μ„Όμ„/λ¨ν„° μ‚¬μ© ν†µκ³„
- **β… λ„¤νΈμ›ν¬ μ •λ³΄**: IP, RSSI, νΈμ¤νΈλ…

---

## β οΈ μ£Όμμ‚¬ν•­ λ° μ„¤μ • ν•„μ”

### 1. ESP32 λ””λ°”μ΄μ¤ ID
- **ν„μ¬**: `esp32_gym` κ³ μ •
- **λΌμ¦λ² λ¦¬νμ΄**: λ‹¤μ¤‘ λ””λ°”μ΄μ¤ μ§€μ› (`esp32_male`, `esp32_female`, `esp32_staff`)
- **ν•΄κ²°λ°©μ•**: ESP32 μ½”λ“μ—μ„ λ””λ°”μ΄μ¤ IDλ¥Ό μ„¤μ • κ°€λ¥ν•κ² μμ • κ¶μ¥

### 2. WiFi μ„¤μ •
- **ν„μ¬**: SSID `sya`, λΉ„λ°€λ²νΈ ν•λ“μ½”λ”©
- **κ¶μ¥**: μ„¤μ • νμΌ λλ” μ›Ή μΈν„°νμ΄μ¤λ¥Ό ν†µν• λ™μ  μ„¤μ •

### 3. λ½μ»¤ κµ¬μ—­ λ§¤ν•‘
- **ESP32**: λ‹¨μΌ λ””λ°”μ΄μ¤λ΅ λ¨λ“  λ½μ»¤ μ μ–΄
- **λΌμ¦λ² λ¦¬νμ΄**: κµ¬μ—­λ³„ λ””λ°”μ΄μ¤ λ¶„λ¦¬ (MALE/FEMALE/STAFF)
- **ν„μ¬ λ§¤ν•‘ λ΅μ§**:
  ```python
  if locker_id.startswith('M'):      # M01~M70 β†’ esp32_male
      device_id = 'esp32_male'
  elif locker_id.startswith('F'):    # F01~F50 β†’ esp32_female  
      device_id = 'esp32_female'
  elif locker_id.startswith('S'):    # S01~S20 β†’ esp32_staff
      device_id = 'esp32_staff'
  ```

### 4. μ„Όμ„ λ§¤ν•‘
- **ν•„μ”**: MCP23017 μ£Όμ†/ν•€κ³Ό λ½μ»¤ ID λ§¤ν•‘ ν…μ΄λΈ”
- **μμ‹**:
  ```
  MCP 0x20, Pin 0 β†’ M01 λ½μ»¤
  MCP 0x20, Pin 1 β†’ M02 λ½μ»¤
  MCP 0x21, Pin 0 β†’ F01 λ½μ»¤
  ```

---

## π”§ κ¶μ¥ κ°μ„ μ‚¬ν•­

### 1. ESP32 μ½”λ“ κ°μ„ 
```cpp
// μ„¤μ • κ°€λ¥ν• λ””λ°”μ΄μ¤ ID
const String DEVICE_ID = "esp32_male";  // λλ” esp32_female, esp32_staff

// WiFi μ„¤μ • νμΌ μ§€μ›
#include "wifi_config.h"  // SSID, λΉ„λ°€λ²νΈ λ¶„λ¦¬

// λ½μ»¤ λ§¤ν•‘ ν…μ΄λΈ”
struct LockerMapping {
  String locker_id;
  uint8_t mcp_addr;
  uint8_t pin;
};
```

### 2. λΌμ¦λ² λ¦¬νμ΄ μ‹μ¤ν… κ°μ„ 
- **λ‹¤μ¤‘ ESP32 κ΄€λ¦¬**: κµ¬μ—­λ³„ λ””λ°”μ΄μ¤ μλ™ κ°μ§€ λ° μ—°κ²°
- **μ„Όμ„ λ§¤ν•‘ DB**: λ¬Όλ¦¬μ  μ„Όμ„μ™€ λ½μ»¤ ID μ—°κ²° ν…μ΄λΈ”
- **OTA κ΄€λ¦¬**: λΌμ¦λ² λ¦¬νμ΄μ—μ„ ESP32 νμ›¨μ–΄ μ—…λ°μ΄νΈ κ΄€λ¦¬

---

## π€ μ΄μ μ¤€λΉ„λ„

### μ†ν”„νΈμ›¨μ–΄ νΈν™μ„±: β… 100%
- λ¨λ“  λ©”μ‹μ§€ ν•μ‹ μ™„λ²½ νΈν™
- λ…λ Ήμ–΄ μ²λ¦¬ μ •μƒ μ‘λ™
- μ—λ¬ μ²λ¦¬ μ™„λ²½ κµ¬ν„

### ν•λ“μ›¨μ–΄ μ—°λ™: β… 95%
- λ°”μ½”λ“ μ¤μΊλ„: μ™„λ²½ μ§€μ›
- μ¤ν…νΌ λ¨ν„°: μ •ν™•ν• μ μ–΄
- IR μ„Όμ„: μ‹¤μ‹κ°„ κ°μ§€
- **μ£Όμ**: λ¬Όλ¦¬μ  μ—°κ²° λ° μ„Όμ„ λ§¤ν•‘ ν•„μ”

### λ„¤νΈμ›ν¬ κΈ°λ¥: β… 90%
- WiFi μ—°κ²°: μ•μ •μ 
- OTA μ—…λ°μ΄νΈ: μ™„λ²½ μ§€μ›
- mDNS: μλ™ κ²€μƒ‰ κ°€λ¥
- **μ£Όμ**: WiFi μ„¤μ • ν•λ“μ½”λ”©

---

## π“ ν…μ¤νΈ κ²°κ³Ό μ”μ•½

| κΈ°λ¥ | ESP32 β†’ λΌμ¦λ² λ¦¬νμ΄ | λΌμ¦λ² λ¦¬νμ΄ β†’ ESP32 | μƒνƒ |
|------|---------------------|---------------------|------|
| λ°”μ½”λ“ μ¤μΊ” | β… μ •μƒ νμ‹± | - | μ™„λ²½ |
| IR μ„Όμ„ | β… μ •μƒ νμ‹± | - | μ™„λ²½ |
| λ½μ»¤ μ μ–΄ | β… μ‘λ‹µ νμ‹± | β… λ…λ Ή μ „μ†΅ | μ™„λ²½ |
| μƒνƒ μ΅°ν | β… μƒνƒ νμ‹± | β… μ”μ²­ μ „μ†΅ | μ™„λ²½ |
| μ—λ¬ μ²λ¦¬ | β… μ—λ¬ νμ‹± | β… μ—λ¬ μ‘λ‹µ | μ™„λ²½ |
| λ¨ν„° μ μ–΄ | β… μ™„λ£ νμ‹± | β… λ…λ Ή μ „μ†΅ | μ™„λ²½ |

---

## π― κ²°λ΅ 

**ESP32 ν—¬μ¤μ¥ μ»¨νΈλ΅¤λ¬ v7.1 μ½”λ“λ” λΌμ¦λ² λ¦¬νμ΄ μ‹μ¤ν…κ³Ό μ™„λ²½ν•κ² νΈν™λ©λ‹λ‹¤.**

### μ¦‰μ‹ μ΄μ κ°€λ¥ν• κΈ°λ¥
- β… λ°”μ½”λ“ μ¤μΊ” λ° νμ› μΈμ¦
- β… λ½μ»¤ μ—΄κΈ° μ μ–΄ (330λ„ νμ „)
- β… IR μ„Όμ„ κΈ°λ° λ½μ»¤ μƒνƒ κ°μ§€
- β… μ‹¤μ‹κ°„ μƒνƒ λ¨λ‹ν„°λ§
- β… WiFi κΈ°λ° μ›κ²© μ μ–΄
- β… OTA λ¬΄μ„  μ—…λ°μ΄νΈ

### μ„¤μ • ν›„ μ΄μ κ°€λ¥ν• κΈ°λ¥
- β οΈ λ‹¤μ¤‘ ESP32 λ””λ°”μ΄μ¤ κ΄€λ¦¬ (κµ¬μ—­λ³„ λ¶„λ¦¬)
- β οΈ μ„Όμ„-λ½μ»¤ λ§¤ν•‘ ν…μ΄λΈ” κµ¬μ„±
- β οΈ WiFi μ„¤μ • κ΄€λ¦¬

**μΆ…ν•© ν‰κ°€: π† μ‹¤μ  ν—¬μ¤μ¥ μ΄μμ— μ™„μ „ν μ¤€λΉ„λ μƒνƒ**

---

*λ¶„μ„ μ™„λ£μΌ: 2025λ…„ 10μ›” 13μΌ*  
*λ¶„μ„μ: AI Assistant*  
*λ¬Έμ„ λ²„μ „: 1.0*
