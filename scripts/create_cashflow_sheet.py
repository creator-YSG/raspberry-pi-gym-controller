"""
ìŠ¤íƒ€íŠ¸ì—… ì‹¤ì „í˜• í˜„ê¸ˆíë¦„ ì¥ë¶€ ìƒì„± ìŠ¤í¬ë¦½íŠ¸

êµ¬ê¸€ ì‹œíŠ¸ì— í˜„ê¸ˆíë¦„ ê´€ë¦¬ìš© ì‹œíŠ¸ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
"""

import gspread
from google.oauth2.service_account import Credentials
import json
from pathlib import Path
from datetime import datetime

# ì„¤ì • íŒŒì¼ ê²½ë¡œ
BASE_DIR = Path(__file__).resolve().parent.parent
CONFIG_DIR = BASE_DIR / "config"
CREDENTIALS_FILE = CONFIG_DIR / "google_credentials.json"

# êµ¬ê¸€ ì‹œíŠ¸ ì¸ì¦
def authenticate_google_sheets():
    """êµ¬ê¸€ ì‹œíŠ¸ API ì¸ì¦"""
    scope = [
        'https://spreadsheets.google.com/feeds',
        'https://www.googleapis.com/auth/drive'
    ]
    
    credentials = Credentials.from_service_account_file(
        str(CREDENTIALS_FILE), scopes=scope
    )
    
    return gspread.authorize(credentials)

def create_cashflow_spreadsheet(owner_email=None):
    """í˜„ê¸ˆíë¦„ ì¥ë¶€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìƒì„±
    
    Args:
        owner_email: ì†Œìœ ì ì´ë©”ì¼ (ì´ ê³„ì •ì— í¸ì§‘ ê¶Œí•œì´ ë¶€ì—¬ë©ë‹ˆë‹¤)
    """
    
    # ì¸ì¦
    client = authenticate_google_sheets()
    
    # ìƒˆ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìƒì„±
    spreadsheet_title = f"[ìŠ¤íƒ€íŠ¸ì—… ì‹¤ì „í˜•] í˜„ê¸ˆíë¦„ ì¥ë¶€ - {datetime.now().strftime('%Yë…„ %mì›”')}"
    
    print(f"ğŸ“ ìƒˆ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìƒì„± ì¤‘: {spreadsheet_title}")
    spreadsheet = client.create(spreadsheet_title)
    
    print(f"âœ… ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìƒì„± ì™„ë£Œ")
    print(f"ğŸ“ URL: https://docs.google.com/spreadsheets/d/{spreadsheet.id}")
    
    # ì†Œìœ ì ì´ë©”ì¼ì´ ìˆìœ¼ë©´ ê³µìœ 
    if owner_email:
        try:
            print(f"\nğŸ” {owner_email}ì—ê²Œ ì†Œìœ ì ê¶Œí•œ ë¶€ì—¬ ì¤‘...")
            spreadsheet.share(owner_email, perm_type='user', role='owner', notify=True)
            print(f"âœ… {owner_email}ì—ê²Œ ì†Œìœ ì ê¶Œí•œ ë¶€ì—¬ ì™„ë£Œ")
        except Exception as e:
            print(f"âš ï¸ ì†Œìœ ì ê¶Œí•œ ë¶€ì—¬ ì‹¤íŒ¨: {e}")
            print(f"   í¸ì§‘ ê¶Œí•œìœ¼ë¡œ ì‹œë„í•©ë‹ˆë‹¤...")
            try:
                spreadsheet.share(owner_email, perm_type='user', role='writer', notify=True)
                print(f"âœ… {owner_email}ì—ê²Œ í¸ì§‘ ê¶Œí•œ ë¶€ì—¬ ì™„ë£Œ")
            except Exception as e2:
                print(f"âš ï¸ ê¶Œí•œ ë¶€ì—¬ ì‹¤íŒ¨: {e2}")
    
    # ì²« ë²ˆì§¸ ì‹œíŠ¸ ê°€ì ¸ì˜¤ê¸°
    worksheet = spreadsheet.sheet1
    worksheet.update_title("í˜„ê¸ˆíë¦„ì¥ë¶€")
    
    # í—¤ë” ì„¤ì •
    headers = [
        "ë‚ ì§œ", "êµ¬ë¶„", "ëŒ€ë¶„ë¥˜", "ìƒì„¸í•­ëª©", "ê±°ë˜ì²˜", 
        "ê³µê¸‰ê°€ì•¡", "ë¶€ê°€ì„¸", "í•©ê³„(ì§€ì¶œì•¡)", "ê²°ì œìˆ˜ë‹¨", "ì¦ë¹™", "ë¹„ê³ "
    ]
    
    # í—¤ë” ìŠ¤íƒ€ì¼ ì ìš©
    worksheet.update('A1:K1', [headers])
    
    # í—¤ë” ì„œì‹ ì„¤ì • (êµµê²Œ, ë°°ê²½ìƒ‰)
    worksheet.format('A1:K1', {
        'backgroundColor': {'red': 0.2, 'green': 0.5, 'blue': 0.8},
        'textFormat': {'bold': True, 'foregroundColor': {'red': 1, 'green': 1, 'blue': 1}},
        'horizontalAlignment': 'CENTER'
    })
    
    # ì˜ˆì‹œ ë°ì´í„° ì¶”ê°€
    example_data = [
        [
            "2025-12-21", "ì§€ì¶œ", "ì œí’ˆ/ì œì¡°", "ë°•ìŠ¤ ì¸ì‡„ë¹„", "(ì£¼)ìŠ¤í†°íŒ©",
            500000, 50000, 550000, "ê°œì¸ì¹´ë“œ", "ì¹´ë“œì˜ìˆ˜ì¦", "ìƒ˜í”Œ 500ê°œ"
        ],
        [
            "2025-12-20", "ì§€ì¶œ", "ë§ˆì¼€íŒ…/ì˜ì—…", "ì¸ìŠ¤íƒ€ê·¸ë¨ ê´‘ê³ ", "Meta",
            100000, "", 100000, "ê°œì¸ì¹´ë“œ", "ì¹´ë“œì˜ìˆ˜ì¦", "12/15-12/20 ìº í˜ì¸"
        ],
        [
            "2025-12-19", "ì§€ì¶œ", "ìš´ì˜ë¹„", "ë…¸ì…˜ êµ¬ë…ë£Œ", "Notion Labs",
            8000, "", 8000, "ê°œì¸ì¹´ë“œ", "ì¹´ë“œì˜ìˆ˜ì¦", "íŒ€ í”Œëœ ì›”ê²°ì œ"
        ]
    ]
    
    worksheet.update('A2:K4', example_data)
    
    # ì—´ ë„ˆë¹„ ì¡°ì • (gspreadì˜ set_column_width ì‚¬ìš©)
    try:
        worksheet.set_column_width('A', 100)  # ë‚ ì§œ
        worksheet.set_column_width('B', 70)   # êµ¬ë¶„
        worksheet.set_column_width('C', 100)  # ëŒ€ë¶„ë¥˜
        worksheet.set_column_width('D', 120)  # ìƒì„¸í•­ëª©
        worksheet.set_column_width('E', 120)  # ê±°ë˜ì²˜
        worksheet.set_column_width('F', 100)  # ê³µê¸‰ê°€ì•¡
        worksheet.set_column_width('G', 80)   # ë¶€ê°€ì„¸
        worksheet.set_column_width('H', 100)  # í•©ê³„
        worksheet.set_column_width('I', 100)  # ê²°ì œìˆ˜ë‹¨
        worksheet.set_column_width('J', 100)  # ì¦ë¹™
        worksheet.set_column_width('K', 150)  # ë¹„ê³ 
        print("âœ… ì—´ ë„ˆë¹„ ì¡°ì • ì™„ë£Œ")
    except AttributeError:
        print("âš ï¸ ì—´ ë„ˆë¹„ ì¡°ì •ì€ ìˆ˜ë™ìœ¼ë¡œ í•´ì£¼ì„¸ìš”")
    
    # ë°ì´í„° í™•ì¸ ê·œì¹™ ì„¤ì • (ìˆ˜ë™ ì„¤ì • ì•ˆë‚´)
    print("\nğŸ“‹ ë°ì´í„° í™•ì¸ ê·œì¹™ì€ êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”:")
    print("   1. Bì—´(êµ¬ë¶„): ì§€ì¶œ, ìˆ˜ì…, ìê¸ˆíˆ¬ì…")
    print("   2. Cì—´(ëŒ€ë¶„ë¥˜): ì œí’ˆ/ì œì¡°, ë§ˆì¼€íŒ…/ì˜ì—…, ìš´ì˜ë¹„, ì¸ê±´ë¹„/ë³µë¦¬í›„ìƒ, ì—¬ë¹„êµí†µë¹„, ìì‚°/íˆ¬ì, ê¸°íƒ€")
    print("   3. Iì—´(ê²°ì œìˆ˜ë‹¨): ê°œì¸ì¹´ë“œ(ëŒ€í‘œ), ê°œì¸ê³„ì¢Œ(ëŒ€í‘œ), í˜„ê¸ˆ, ë²•ì¸ì¹´ë“œ, ë²•ì¸ê³„ì¢Œ")
    print("   4. Jì—´(ì¦ë¹™): ì„¸ê¸ˆê³„ì‚°ì„œ, ì¹´ë“œì˜ìˆ˜ì¦, í˜„ê¸ˆì˜ìˆ˜ì¦, ê°„ì´ì˜ìˆ˜ì¦, ì—†ìŒ")
    print("   ë°©ë²•: ì—´ ì„ íƒ > ë°ì´í„° > ë°ì´í„° í™•ì¸ > ëª©ë¡(í•­ëª© 1ê°œ ë²”ìœ„ì—ì„œ) > ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥")
    print("âœ… í˜„ê¸ˆíë¦„ì¥ë¶€ ì‹œíŠ¸ ìƒì„± ì™„ë£Œ")
    
    # ëŒ€ì‹œë³´ë“œ ì‹œíŠ¸ ìƒì„±
    print("\nğŸ“Š ëŒ€ì‹œë³´ë“œ ì‹œíŠ¸ ìƒì„± ì¤‘...")
    dashboard_sheet = spreadsheet.add_worksheet(title="ëŒ€ì‹œë³´ë“œ", rows="50", cols="10")
    
    # ëŒ€ì‹œë³´ë“œ ë‚´ìš©
    dashboard_content = [
        ["ğŸ’° ìŠ¤íƒ€íŠ¸ì—… í˜„ê¸ˆíë¦„ ëŒ€ì‹œë³´ë“œ", "", "", ""],
        ["", "", "", ""],
        ["ğŸ“… ê¸°ì¤€ ì›”:", datetime.now().strftime("%Yë…„ %mì›”"), "", ""],
        ["", "", "", ""],
        ["ğŸ“Š ì›”ë³„ ìš”ì•½", "", "", ""],
        ["êµ¬ë¶„", "ê¸ˆì•¡ (ì›)", "", ""],
        ["ì´ë²ˆ ë‹¬ ì´ ì§€ì¶œ", "=SUMIF(í˜„ê¸ˆíë¦„ì¥ë¶€!B:B,\"ì§€ì¶œ\",í˜„ê¸ˆíë¦„ì¥ë¶€!H:H)", "", ""],
        ["ì´ë²ˆ ë‹¬ ì´ ìˆ˜ì…", "=SUMIF(í˜„ê¸ˆíë¦„ì¥ë¶€!B:B,\"ìˆ˜ì…\",í˜„ê¸ˆíë¦„ì¥ë¶€!H:H)", "", ""],
        ["ìˆœ í˜„ê¸ˆíë¦„", "=B8-B7", "", ""],
        ["", "", "", ""],
        ["ğŸ’³ ê²°ì œìˆ˜ë‹¨ë³„ ì§€ì¶œ", "", "", ""],
        ["ê°œì¸ì¹´ë“œ(ëŒ€í‘œ)", "=SUMIFS(í˜„ê¸ˆíë¦„ì¥ë¶€!H:H,í˜„ê¸ˆíë¦„ì¥ë¶€!B:B,\"ì§€ì¶œ\",í˜„ê¸ˆíë¦„ì¥ë¶€!I:I,\"ê°œì¸ì¹´ë“œ(ëŒ€í‘œ)\")", "", "â†’ ë²•ì¸ ì „í™˜ ì‹œ ì •ì‚° í•„ìš”"],
        ["ê°œì¸ê³„ì¢Œ(ëŒ€í‘œ)", "=SUMIFS(í˜„ê¸ˆíë¦„ì¥ë¶€!H:H,í˜„ê¸ˆíë¦„ì¥ë¶€!B:B,\"ì§€ì¶œ\",í˜„ê¸ˆíë¦„ì¥ë¶€!I:I,\"ê°œì¸ê³„ì¢Œ(ëŒ€í‘œ)\")", "", "â†’ ë²•ì¸ ì „í™˜ ì‹œ ì •ì‚° í•„ìš”"],
        ["í˜„ê¸ˆ", "=SUMIFS(í˜„ê¸ˆíë¦„ì¥ë¶€!H:H,í˜„ê¸ˆíë¦„ì¥ë¶€!B:B,\"ì§€ì¶œ\",í˜„ê¸ˆíë¦„ì¥ë¶€!I:I,\"í˜„ê¸ˆ\")", "", ""],
        ["", "", "", ""],
        ["ğŸ“‚ ëŒ€ë¶„ë¥˜ë³„ ì§€ì¶œ", "", "", ""],
        ["ì œí’ˆ/ì œì¡°", "=SUMIFS(í˜„ê¸ˆíë¦„ì¥ë¶€!H:H,í˜„ê¸ˆíë¦„ì¥ë¶€!B:B,\"ì§€ì¶œ\",í˜„ê¸ˆíë¦„ì¥ë¶€!C:C,\"ì œí’ˆ/ì œì¡°\")", "", ""],
        ["ë§ˆì¼€íŒ…/ì˜ì—…", "=SUMIFS(í˜„ê¸ˆíë¦„ì¥ë¶€!H:H,í˜„ê¸ˆíë¦„ì¥ë¶€!B:B,\"ì§€ì¶œ\",í˜„ê¸ˆíë¦„ì¥ë¶€!C:C,\"ë§ˆì¼€íŒ…/ì˜ì—…\")", "", ""],
        ["ìš´ì˜ë¹„", "=SUMIFS(í˜„ê¸ˆíë¦„ì¥ë¶€!H:H,í˜„ê¸ˆíë¦„ì¥ë¶€!B:B,\"ì§€ì¶œ\",í˜„ê¸ˆíë¦„ì¥ë¶€!C:C,\"ìš´ì˜ë¹„\")", "", ""],
        ["ì¸ê±´ë¹„/ë³µë¦¬í›„ìƒ", "=SUMIFS(í˜„ê¸ˆíë¦„ì¥ë¶€!H:H,í˜„ê¸ˆíë¦„ì¥ë¶€!B:B,\"ì§€ì¶œ\",í˜„ê¸ˆíë¦„ì¥ë¶€!C:C,\"ì¸ê±´ë¹„/ë³µë¦¬í›„ìƒ\")", "", ""],
        ["ì—¬ë¹„êµí†µë¹„", "=SUMIFS(í˜„ê¸ˆíë¦„ì¥ë¶€!H:H,í˜„ê¸ˆíë¦„ì¥ë¶€!B:B,\"ì§€ì¶œ\",í˜„ê¸ˆíë¦„ì¥ë¶€!C:C,\"ì—¬ë¹„êµí†µë¹„\")", "", ""],
        ["ìì‚°/íˆ¬ì", "=SUMIFS(í˜„ê¸ˆíë¦„ì¥ë¶€!H:H,í˜„ê¸ˆíë¦„ì¥ë¶€!B:B,\"ì§€ì¶œ\",í˜„ê¸ˆíë¦„ì¥ë¶€!C:C,\"ìì‚°/íˆ¬ì\")", "", ""],
        ["ê¸°íƒ€", "=SUMIFS(í˜„ê¸ˆíë¦„ì¥ë¶€!H:H,í˜„ê¸ˆíë¦„ì¥ë¶€!B:B,\"ì§€ì¶œ\",í˜„ê¸ˆíë¦„ì¥ë¶€!C:C,\"ê¸°íƒ€\")", "", ""],
        ["", "", "", ""],
        ["ğŸ“Œ ì¦ë¹™ ì²´í¬ë¦¬ìŠ¤íŠ¸", "", "", ""],
        ["ì¦ë¹™ ì—†ìŒ ê±´ìˆ˜", "=COUNTIFS(í˜„ê¸ˆíë¦„ì¥ë¶€!J:J,\"ì—†ìŒ\")", "", "âš ï¸ ì„¸ë¬´ ì²˜ë¦¬ ì£¼ì˜"],
        ["", "", "", ""],
        ["ğŸ’¡ ì„¸ë¬´ íŒ:", "", "", ""],
        ["â€¢ ê°œì¸ì¹´ë“œ/ê³„ì¢Œ ì‚¬ìš© ê¸ˆì•¡ì€ ë²•ì¸ ì „í™˜ ì‹œ ì •ì‚° ê°€ëŠ¥í•©ë‹ˆë‹¤", "", "", ""],
        ["â€¢ ì¦ë¹™ ì—†ëŠ” ì§€ì¶œì€ 3ë§Œ ì› ì´í•˜ë§Œ ì•ˆì „í•©ë‹ˆë‹¤", "", "", ""],
        ["â€¢ ì˜ìˆ˜ì¦ì€ êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ë°±ì—…í•˜ì„¸ìš”", "", "", ""],
    ]
    
    dashboard_sheet.update('A1:D31', dashboard_content)
    
    # ëŒ€ì‹œë³´ë“œ ì„œì‹ ì„¤ì •
    dashboard_sheet.format('A1:D1', {
        'backgroundColor': {'red': 1, 'green': 0.7, 'blue': 0},
        'textFormat': {'bold': True, 'fontSize': 16},
        'horizontalAlignment': 'LEFT'
    })
    
    dashboard_sheet.format('A5:A5', {
        'backgroundColor': {'red': 0.9, 'green': 0.9, 'blue': 0.9},
        'textFormat': {'bold': True}
    })
    
    dashboard_sheet.format('A11:A11', {
        'backgroundColor': {'red': 0.9, 'green': 0.9, 'blue': 0.9},
        'textFormat': {'bold': True}
    })
    
    dashboard_sheet.format('A16:A16', {
        'backgroundColor': {'red': 0.9, 'green': 0.9, 'blue': 0.9},
        'textFormat': {'bold': True}
    })
    
    dashboard_sheet.format('A25:A25', {
        'backgroundColor': {'red': 0.9, 'green': 0.9, 'blue': 0.9},
        'textFormat': {'bold': True}
    })
    
    # ê¸ˆì•¡ ì…€ ì„œì‹ (í†µí™”)
    dashboard_sheet.format('B7:B14', {
        'numberFormat': {'type': 'NUMBER', 'pattern': '#,##0'}
    })
    
    dashboard_sheet.format('B17:B23', {
        'numberFormat': {'type': 'NUMBER', 'pattern': '#,##0'}
    })
    
    # ìˆœ í˜„ê¸ˆíë¦„ ì…€ ê°•ì¡°
    dashboard_sheet.format('B9:B9', {
        'backgroundColor': {'red': 1, 'green': 1, 'blue': 0.8},
        'textFormat': {'bold': True},
        'numberFormat': {'type': 'NUMBER', 'pattern': '#,##0'}
    })
    
    # ì—´ ë„ˆë¹„ ì¡°ì •
    dashboard_sheet.set_column_width('A', 200)
    dashboard_sheet.set_column_width('B', 150)
    dashboard_sheet.set_column_width('C', 50)
    dashboard_sheet.set_column_width('D', 250)
    
    print("âœ… ëŒ€ì‹œë³´ë“œ ì‹œíŠ¸ ìƒì„± ì™„ë£Œ")
    
    # ê°€ì´ë“œ ì‹œíŠ¸ ìƒì„±
    print("\nğŸ“– ì‚¬ìš© ê°€ì´ë“œ ì‹œíŠ¸ ìƒì„± ì¤‘...")
    guide_sheet = spreadsheet.add_worksheet(title="ì‚¬ìš©ê°€ì´ë“œ", rows="40", cols="5")
    
    guide_content = [
        ["ğŸ“˜ ìŠ¤íƒ€íŠ¸ì—… ì‹¤ì „í˜• í˜„ê¸ˆíë¦„ ì¥ë¶€ ì‚¬ìš© ê°€ì´ë“œ", "", "", "", ""],
        ["", "", "", "", ""],
        ["1ï¸âƒ£ ê¸°ë³¸ ì‚¬ìš©ë²•", "", "", "", ""],
        ["", "", "", "", ""],
        ["â€¢ ë§¤ì¼ ì§€ì¶œ/ìˆ˜ì…ì´ ë°œìƒí•  ë•Œë§ˆë‹¤ 'í˜„ê¸ˆíë¦„ì¥ë¶€' ì‹œíŠ¸ì— ê¸°ë¡í•˜ì„¸ìš”", "", "", "", ""],
        ["â€¢ ë“œë¡­ë‹¤ìš´ì´ ì„¤ì •ëœ í•­ëª©ì€ í´ë¦­í•´ì„œ ì„ íƒí•˜ì„¸ìš” (ì˜¤íƒ€ ë°©ì§€)", "", "", "", ""],
        ["â€¢ ë¶€ê°€ì„¸ì™€ í•©ê³„ëŠ” ìë™ ê³„ì‚°í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”", "", "", "", ""],
        ["â€¢ ì¦ë¹™ ì‚¬ì§„ì€ êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ë³„ë„ ì €ì¥í•˜ê³  'ë¹„ê³ 'ì— ë§í¬ë¥¼ ê±¸ì–´ë‘ì„¸ìš”", "", "", "", ""],
        ["", "", "", "", ""],
        ["2ï¸âƒ£ ê° í•­ëª© ì„¤ëª…", "", "", "", ""],
        ["", "", "", "", ""],
        ["í•­ëª©", "ì„¤ëª…", "ì˜ˆì‹œ", "", ""],
        ["ë‚ ì§œ", "ê±°ë˜ ë°œìƒ ë‚ ì§œ", "2025-12-21", "", ""],
        ["êµ¬ë¶„", "ì§€ì¶œ/ìˆ˜ì…/ìê¸ˆíˆ¬ì…", "ì§€ì¶œ", "", ""],
        ["ëŒ€ë¶„ë¥˜", "ì§€ì¶œì˜ ìš©ë„ ì¹´í…Œê³ ë¦¬", "ì œí’ˆ/ì œì¡°", "", ""],
        ["ìƒì„¸í•­ëª©", "êµ¬ì²´ì ì¸ ì§€ì¶œ ë‚´ì—­", "ë°•ìŠ¤ ì¸ì‡„ë¹„", "", ""],
        ["ê±°ë˜ì²˜", "ê±°ë˜í•œ ì—…ì²´ëª…", "(ì£¼)ìŠ¤í†°íŒ©", "", ""],
        ["ê³µê¸‰ê°€ì•¡", "ë¶€ê°€ì„¸ ì œì™¸ ê¸ˆì•¡", "500,000", "", ""],
        ["ë¶€ê°€ì„¸", "ë¶€ê°€ì„¸ (ê³µê¸‰ê°€ì•¡ì˜ 10%)", "50,000", "", ""],
        ["í•©ê³„(ì§€ì¶œì•¡)", "ì‹¤ì œ ì§€ë¶ˆí•œ ì´ ê¸ˆì•¡", "550,000", "", ""],
        ["ê²°ì œìˆ˜ë‹¨", "ì–´ë–¤ ë°©ë²•ìœ¼ë¡œ ê²°ì œí–ˆëŠ”ì§€", "ê°œì¸ì¹´ë“œ(ëŒ€í‘œ)", "", ""],
        ["ì¦ë¹™", "ì¦ë¹™ ì¢…ë¥˜", "ì¹´ë“œì˜ìˆ˜ì¦", "", ""],
        ["ë¹„ê³ ", "ì¶”ê°€ ë©”ëª¨", "ìƒ˜í”Œ 500ê°œ", "", ""],
        ["", "", "", "", ""],
        ["3ï¸âƒ£ ëŒ€ì‹œë³´ë“œ í™œìš©", "", "", "", ""],
        ["", "", "", "", ""],
        ["â€¢ 'ëŒ€ì‹œë³´ë“œ' ì‹œíŠ¸ì—ì„œ ì´ë²ˆ ë‹¬ í˜„ê¸ˆíë¦„ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”", "", "", "", ""],
        ["â€¢ ê°œì¸ì¹´ë“œ/ê³„ì¢Œ ì‚¬ìš© ê¸ˆì•¡ì€ ë‚˜ì¤‘ì— ë²•ì¸ ì „í™˜ ì‹œ ì •ì‚° ê°€ëŠ¥í•©ë‹ˆë‹¤", "", "", "", ""],
        ["â€¢ ëŒ€ë¶„ë¥˜ë³„ ì§€ì¶œì„ ë³´ê³  ì–´ë””ì— ëˆì´ ë§ì´ ë‚˜ê°€ëŠ”ì§€ íŒŒì•…í•˜ì„¸ìš”", "", "", "", ""],
        ["", "", "", "", ""],
        ["4ï¸âƒ£ ì„¸ë¬´ ì²˜ë¦¬ íŒ", "", "", "", ""],
        ["", "", "", "", ""],
        ["â€¢ ì¦ë¹™ì´ ì—†ëŠ” ì§€ì¶œì€ 3ë§Œ ì› ì´í•˜ë§Œ ì•ˆì „í•©ë‹ˆë‹¤", "", "", "", ""],
        ["â€¢ ì¹´ë“œì˜ìˆ˜ì¦ì´ ê°€ì¥ í™•ì‹¤í•œ ì¦ë¹™ì…ë‹ˆë‹¤", "", "", "", ""],
        ["â€¢ í˜„ê¸ˆ ì§€ì¶œì€ ë°˜ë“œì‹œ í˜„ê¸ˆì˜ìˆ˜ì¦ì„ ë°›ìœ¼ì„¸ìš” (ì‚¬ì—…ìë²ˆí˜¸ ì œì‹œ)", "", "", "", ""],
        ["â€¢ ì´ ì¥ë¶€ë¥¼ ê·¸ëŒ€ë¡œ ì„¸ë¬´ì‚¬ì—ê²Œ ì „ë‹¬í•˜ë©´ ë©ë‹ˆë‹¤", "", "", "", ""],
        ["", "", "", "", ""],
        ["ğŸ’¡ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”!", "", "", "", ""],
    ]
    
    guide_sheet.update('A1:E38', guide_content)
    
    # ê°€ì´ë“œ ì„œì‹ ì„¤ì •
    guide_sheet.format('A1:E1', {
        'backgroundColor': {'red': 0.3, 'green': 0.7, 'blue': 0.3},
        'textFormat': {'bold': True, 'fontSize': 14, 'foregroundColor': {'red': 1, 'green': 1, 'blue': 1}},
        'horizontalAlignment': 'LEFT'
    })
    
    guide_sheet.format('A3:A3', {
        'textFormat': {'bold': True, 'fontSize': 12}
    })
    
    guide_sheet.format('A10:A10', {
        'textFormat': {'bold': True, 'fontSize': 12}
    })
    
    guide_sheet.format('A12:C12', {
        'backgroundColor': {'red': 0.9, 'green': 0.9, 'blue': 0.9},
        'textFormat': {'bold': True}
    })
    
    guide_sheet.format('A25:A25', {
        'textFormat': {'bold': True, 'fontSize': 12}
    })
    
    guide_sheet.format('A31:A31', {
        'textFormat': {'bold': True, 'fontSize': 12}
    })
    
    # ì—´ ë„ˆë¹„ ì¡°ì •
    guide_sheet.set_column_width('A', 150)
    guide_sheet.set_column_width('B', 250)
    guide_sheet.set_column_width('C', 150)
    
    print("âœ… ì‚¬ìš© ê°€ì´ë“œ ì‹œíŠ¸ ìƒì„± ì™„ë£Œ")
    
    # ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ê³µìœ  ì„¤ì • (ëˆ„êµ¬ë‚˜ í¸ì§‘ ê°€ëŠ¥)
    print("\nğŸ” ê³µìœ  ì„¤ì • ì¤‘...")
    try:
        # ë§í¬ë¥¼ ì•„ëŠ” ì‚¬ëŒì€ ëˆ„êµ¬ë‚˜ í¸ì§‘ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
        spreadsheet.share('', perm_type='anyone', role='writer', with_link=True)
        print("âœ… ê³µìœ  ì„¤ì • ì™„ë£Œ (ë§í¬ë¥¼ ì•„ëŠ” ì‚¬ëŒì€ ëˆ„êµ¬ë‚˜ í¸ì§‘ ê°€ëŠ¥)")
    except Exception as e:
        print(f"âš ï¸ ê³µìœ  ì„¤ì • ì¤‘ ì˜¤ë¥˜: {e}")
        print("   ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”: íŒŒì¼ > ê³µìœ  > ì¼ë°˜ ì•¡ì„¸ìŠ¤ > ë§í¬ê°€ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ì")
    
    print("\n" + "="*70)
    print("ğŸ‰ ìŠ¤íƒ€íŠ¸ì—… í˜„ê¸ˆíë¦„ ì¥ë¶€ ìƒì„± ì™„ë£Œ!")
    print("="*70)
    print(f"\nğŸ“ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ URL:")
    print(f"   https://docs.google.com/spreadsheets/d/{spreadsheet.id}\n")
    print("ğŸ“‹ ìƒì„±ëœ ì‹œíŠ¸:")
    print("   1. í˜„ê¸ˆíë¦„ì¥ë¶€ - ì¼ì¼ ê±°ë˜ ê¸°ë¡ìš©")
    print("   2. ëŒ€ì‹œë³´ë“œ - ì›”ë³„ ìš”ì•½ ë° í†µê³„")
    print("   3. ì‚¬ìš©ê°€ì´ë“œ - ìƒì„¸í•œ ì‚¬ìš© ë°©ë²•\n")
    print("ğŸ’¡ ë‹¤ìŒ ë‹¨ê³„:")
    print("   1. ìœ„ URLì„ ë¶ë§ˆí¬ì— ì €ì¥í•˜ì„¸ìš”")
    print("   2. ë§¤ì¼ ì§€ì¶œ/ìˆ˜ì… ë°œìƒ ì‹œ ë°”ë¡œ ê¸°ë¡í•˜ì„¸ìš”")
    print("   3. ë°ì´í„°ê°€ 10ì¤„ ì •ë„ ìŒ“ì´ë©´ ëŒ€ì‹œë³´ë“œë¥¼ í™•ì¸í•˜ì„¸ìš”")
    print("   4. ì¦ë¹™ ì‚¬ì§„ì€ êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ë³„ë„ í´ë”ë¡œ ê´€ë¦¬í•˜ì„¸ìš”\n")
    
    return spreadsheet

if __name__ == "__main__":
    print("ğŸš€ ìŠ¤íƒ€íŠ¸ì—… ì‹¤ì „í˜• í˜„ê¸ˆíë¦„ ì¥ë¶€ ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤...\n")
    
    # ì†Œìœ ì ì´ë©”ì¼ ì…ë ¥ë°›ê¸° (ì˜µì…˜)
    import sys
    owner_email = None
    if len(sys.argv) > 1:
        owner_email = sys.argv[1]
        print(f"ğŸ“§ ì†Œìœ ì ì´ë©”ì¼: {owner_email}\n")
    else:
        print("ğŸ’¡ íŒ: ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹œ ì´ë©”ì¼ì„ ì¸ìë¡œ ì „ë‹¬í•˜ë©´ ìë™ìœ¼ë¡œ ê³µìœ ë©ë‹ˆë‹¤.")
        print("   ì˜ˆ: python3 create_cashflow_sheet.py your@email.com\n")
    
    try:
        spreadsheet = create_cashflow_spreadsheet(owner_email)
    except FileNotFoundError:
        print(f"âŒ ì˜¤ë¥˜: ì¸ì¦ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        print(f"   ê²½ë¡œ: {CREDENTIALS_FILE}")
    except Exception as e:
        print(f"âŒ ì˜¤ë¥˜ ë°œìƒ: {e}")
        import traceback
        traceback.print_exc()

